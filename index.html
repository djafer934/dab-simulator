<!DOCTYPE html> 
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DAB - La Banque du Peuple</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .container { 
    max-width: 450px; 
    width: 100%;
    background: white; 
    padding: 30px; 
    border-radius: 15px; 
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  }
  h1 { 
    text-align: center; 
    color: #2563eb; 
    margin-bottom: 10px;
    font-size: 1.8em;
  }
  h2 { 
    text-align: center; 
    color: #2563eb; 
    margin-bottom: 20px;
    font-size: 1.4em;
  }
  .screen { display: none; }
  .screen.active { display: block; animation: fadeIn 0.3s; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  
  .form-group { margin-bottom: 15px; }
  label { 
    display: block; 
    margin-bottom: 8px; 
    font-weight: 600;
    color: #374151;
  }
  input { 
    width: 100%; 
    padding: 12px; 
    font-size: 16px; 
    border: 2px solid #e5e7eb; 
    border-radius: 8px;
    transition: border-color 0.3s;
  }
  input:focus { 
    border-color: #2563eb; 
    outline: none; 
  }
  
  button { 
    width: 100%; 
    padding: 14px; 
    font-size: 16px; 
    font-weight: 600;
    background: #2563eb; 
    color: white; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    margin: 8px 0;
    transition: all 0.3s;
  }
  button:hover { 
    background: #1d4ed8; 
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(37,99,235,0.3);
  }
  button.secondary { 
    background: #6b7280; 
  }
  button.secondary:hover { 
    background: #4b5563; 
  }
  
  .balance { 
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    color: white; 
    padding: 25px; 
    border-radius: 12px; 
    text-align: center; 
    margin: 20px 0;
    box-shadow: 0 4px 15px rgba(37,99,235,0.3);
  }
  .balance h2 { color: white; margin: 0; font-size: 2em; }
  .balance p { margin-top: 5px; opacity: 0.9; }
  
  .error { 
    background: #fee2e2; 
    color: #991b1b; 
    padding: 12px; 
    border-radius: 8px; 
    margin: 10px 0; 
    border-left: 4px solid #dc2626; 
    display: none; 
  }
  .error.show { display: block; }
  
  .success { 
    background: #d1fae5; 
    color: #065f46; 
    padding: 12px; 
    border-radius: 8px; 
    margin: 10px 0; 
    border-left: 4px solid #10b981; 
    display: none; 
  }
  .success.show { display: block; }
  
  .menu-item { 
    background: #f9fafb; 
    border: 2px solid #e5e7eb; 
    text-align: left; 
    display: flex; 
    align-items: center; 
    padding: 16px;
    font-weight: 600;
    color: #1f2937;
  }
  .menu-item:hover { 
    border-color: #2563eb;
    background: #eff6ff;
  }
  .menu-icon { 
    margin-right: 12px; 
    font-size: 1.5em; 
  }
  
  .history-item {
    background: #f9fafb;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    border-left: 4px solid #2563eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .history-list {
    max-height: 400px;
    overflow-y: auto;
    margin: 15px 0;
  }
  .history-list::-webkit-scrollbar { width: 6px; }
  .history-list::-webkit-scrollbar-track { background: #f1f1f1; }
  .history-list::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
</style>
</head>
<body>
  <div class="container">
    <h1>🏧 La Banque du Peuple</h1>

    <!-- ÉCRAN 1 : Authentification -->
    <div id="loginScreen" class="screen active">
      <h2>Authentification</h2>
      <div class="form-group">
        <label for="cardNumber">Numéro de carte (16 chiffres)</label>
        <input type="text" id="cardNumber" maxlength="16" placeholder="1234567890123456">
      </div>
      <div class="form-group">
        <label for="secret">Code secret (4 chiffres)</label>
        <input type="password" id="secret" maxlength="4" placeholder="****">
      </div>
      <div id="loginError" class="error"></div>
      <button onclick="login()">Se connecter</button>
      <button class="secondary" onclick="showOperatorLogin()">🔧 Mode Opérateur</button>
    </div>

    <!-- ÉCRAN 2 : Menu Client -->
    <div id="menuScreen" class="screen">
      <h2>Bonjour <span id="userName">Client</span> !</h2>
      <button class="menu-item" onclick="showBalance()">
        <span class="menu-icon">👁️</span>
        <span>Voir mon solde</span>
      </button>
      <button class="menu-item" onclick="showWithdraw()">
        <span class="menu-icon">💰</span>
        <span>Retirer de l'argent</span>
      </button>
      <button class="menu-item" onclick="showDeposit()">
        <span class="menu-icon">➕</span>
        <span>Déposer de l'argent</span>
      </button>
      <button class="menu-item" onclick="showHistory()">
        <span class="menu-icon">📋</span>
        <span>Historique des opérations</span>
      </button>
      <button class="secondary" onclick="logout()">Déconnexion</button>
    </div>

    <!-- ÉCRAN 3 : Solde -->
    <div id="balanceScreen" class="screen">
      <h2>Votre solde</h2>
      <div class="balance">
        <h2 id="balanceAmount">0 €</h2>
        <p>Solde disponible</p>
      </div>
      <button class="secondary" onclick="backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 4 : Retrait -->
    <div id="withdrawScreen" class="screen">
      <h2>Retirer de l'argent</h2>
      <div class="form-group">
        <label for="withdrawAmount">Montant à retirer</label>
        <input type="number" id="withdrawAmount" min="10" max="500" step="10" placeholder="Ex: 50">
      </div>
      <div id="withdrawError" class="error"></div>
      <div id="withdrawSuccess" class="success"></div>
      <button onclick="withdraw()">Confirmer le retrait</button>
      <button class="secondary" onclick="backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 5 : Dépôt -->
    <div id="depositScreen" class="screen">
      <h2>Déposer de l'argent</h2>
      <div class="form-group">
        <label for="depositAmount">Montant à déposer</label>
        <input type="number" id="depositAmount" min="10" step="10" placeholder="Ex: 100">
      </div>
      <div id="depositError" class="error"></div>
      <div id="depositSuccess" class="success"></div>
      <button onclick="deposit()">Confirmer le dépôt</button>
      <button class="secondary" onclick="backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 6 : Historique -->
    <div id="historyScreen" class="screen">
      <h2>📋 Historique</h2>
      <div id="historyList" class="history-list"></div>
      <button class="secondary" onclick="backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 7 : Connexion Opérateur -->
    <div id="operatorLoginScreen" class="screen">
      <h2>🔧 Mode Opérateur</h2>
      <div class="form-group">
        <label for="operatorCode">Code Opérateur</label>
        <input type="password" id="operatorCode" maxlength="6" placeholder="******">
      </div>
      <div id="operatorLoginError" class="error"></div>
      <button onclick="operatorLogin()">Se connecter</button>
      <button class="secondary" onclick="showScreen('loginScreen')">← Retour</button>
    </div>

    <!-- ÉCRAN 8 : Menu Opérateur -->
    <div id="operatorMenuScreen" class="screen">
      <h2>🔧 Menu Opérateur</h2>
      <p style="text-align:center; margin-bottom:20px; color:#6b7280;">Bienvenue Opérateur</p>
      <button class="menu-item" onclick="showBlockedCards()">
        <span class="menu-icon">🔒</span>
        <span>Cartes avalées</span>
      </button>
      <button class="menu-item" onclick="showCollectDeposits()">
        <span class="menu-icon">💰</span>
        <span>Collecter dépôts</span>
      </button>
      <button class="menu-item" onclick="showRefillATM()">
        <span class="menu-icon">🏧</span>
        <span>Recharger DAB</span>
      </button>
      <button class="menu-item" onclick="showStatistics()">
        <span class="menu-icon">📊</span>
        <span>Statistiques</span>
      </button>
      <button class="secondary" onclick="operatorLogout()">Déconnexion</button>
    </div>

    <!-- ÉCRAN 9 : Cartes avalées -->
    <div id="blockedCardsScreen" class="screen">
      <h2>🔒 Cartes avalées</h2>
      <div id="blockedCardsList" style="margin:20px 0;"></div>
      <button onclick="releaseAllCards()">🔓 Libérer toutes les cartes</button>
      <button class="secondary" onclick="showScreen('operatorMenuScreen')">← Retour</button>
    </div>

    <!-- ÉCRAN 10 : Collecter dépôts -->
    <div id="collectScreen" class="screen">
      <h2>💰 Collecter dépôts</h2>
      <div class="balance">
        <h2><span id="totalDeposits">0 €</span></h2>
        <p>Total à collecter</p>
      </div>
      <button onclick="collectDeposits()">✅ Marquer comme collecté</button>
      <button class="secondary" onclick="showScreen('operatorMenuScreen')">← Retour</button>
    </div>

    <!-- ÉCRAN 11 : Recharger DAB -->
    <div id="refillScreen" class="screen">
      <h2>🏧 Recharger DAB</h2>
      <div class="form-group">
        <label for="refillAmount">Montant à ajouter (€)</label>
        <input type="number" id="refillAmount" placeholder="Ex: 5000" step="100">
      </div>
      <div id="refillMessage" class="success"></div>
      <button onclick="refillATM()">💰 Recharger la machine</button>
      <button class="secondary" onclick="showScreen('operatorMenuScreen')">← Retour</button>
    </div>

  </div>

<script>
// Données
const validCards = {
  '1234567890123456': { secret: '6453', name: 'M. Dupont', balance: 2500, type: 'Banque' },
  '9876543210987654': { secret: '5628', name: 'Mme Martin', balance: 1750, type: 'Visa' }
};

// Variables globales
let currentUser = null;
let currentOperator = null;
let operationHistory = [];
let loginAttempts = {};
let blockedCards = {};
let totalDepositsToday = 0;
let dailyTransactions = 0;
const operatorCode = '539757';

// Navigation
function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
  hideMessages();
}

function hideMessages() {
  document.querySelectorAll('.error, .success').forEach(el => {
    el.classList.remove('show');
    el.textContent = '';
  });
}

function showError(id, message) {
  const el = document.getElementById(id);
  el.textContent = message;
  el.classList.add('show');
}

function showSuccess(id, message) {
  const el = document.getElementById(id);
  el.textContent = message;
  el.classList.add('show');
}

// Authentification Client
function login() {
  const cardNumber = document.getElementById('cardNumber').value.trim();
  const secret = document.getElementById('secret').value.trim();

  if (blockedCards[cardNumber]) {
    showError('loginError', 'Carte avalée. Contactez le service client.');
    return;
  }

  if (validCards[cardNumber] && validCards[cardNumber].secret === secret) {
    loginAttempts[cardNumber] = 0;
    currentUser = validCards[cardNumber];
    operationHistory = [];
    document.getElementById('userName').textContent = currentUser.name;
    updateBalanceDisplay();
    showScreen('menuScreen');
  } else {
    loginAttempts[cardNumber] = (loginAttempts[cardNumber] || 0) + 1;
    if (loginAttempts[cardNumber] >= 3) {
      blockedCards[cardNumber] = true;
      showError('loginError', 'Carte avalée après 3 tentatives.');
    } else {
      showError('loginError', `Identifiants incorrects (${loginAttempts[cardNumber]}/3)`);
    }
  }
}

function logout() {
  currentUser = null;
  operationHistory = [];
  document.getElementById('cardNumber').value = '';
  document.getElementById('secret').value = '';
  showScreen('loginScreen');
}

// Opérations bancaires
function updateBalanceDisplay() {
  document.getElementById('balanceAmount').textContent = currentUser.balance + ' €';
}

function showBalance() {
  addToHistory('Consultation', 0);
  updateBalanceDisplay();
  showScreen('balanceScreen');
}

function showWithdraw() {
  document.getElementById('withdrawAmount').value = '';
  showScreen('withdrawScreen');
}

function withdraw() {
  hideMessages();
  const amount = parseInt(document.getElementById('withdrawAmount').value, 10);
  
  if (!amount || amount <= 0) {
    showError('withdrawError', 'Montant invalide');
    return;
  }
  if (amount < 10) {
    showError('withdrawError', 'Minimum: 10€');
    return;
  }
  if (amount > 500) {
    showError('withdrawError', 'Maximum: 500€');
    return;
  }
  if (amount % 10 !== 0) {
    showError('withdrawError', 'Multiples de 10€ uniquement');
    return;
  }
  if (amount > currentUser.balance) {
    showError('withdrawError', 'Solde insuffisant');
    return;
  }

  currentUser.balance -= amount;
  dailyTransactions++;
  addToHistory('Retrait', amount);
  updateBalanceDisplay();
  showSuccess('withdrawSuccess', `Retrait de ${amount}€ effectué`);
  document.getElementById('withdrawAmount').value = '';
}

function showDeposit() {
  document.getElementById('depositAmount').value = '';
  showScreen('depositScreen');
}

function deposit() {
  hideMessages();
  const amount = parseInt(document.getElementById('depositAmount').value, 10);
  
  if (!amount || amount <= 0) {
    showError('depositError', 'Montant invalide');
    return;
  }
  if (amount < 10) {
    showError('depositError', 'Minimum: 10€');
    return;
  }
  if (amount % 10 !== 0) {
    showError('depositError', 'Multiples de 10€ uniquement');
    return;
  }

  currentUser.balance += amount;
  totalDepositsToday += amount;
  dailyTransactions++;
  addToHistory('Dépôt', amount);
  updateBalanceDisplay();
  showSuccess('depositSuccess', `Dépôt de ${amount}€ effectué`);
  document.getElementById('depositAmount').value = '';
}

// Historique
function addToHistory(type, amount) {
  const now = new Date();
  operationHistory.unshift({
    type: type,
    amount: amount,
    date: now.toLocaleDateString('fr-FR'),
    time: now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
  });
}

function showHistory() {
  const listEl = document.getElementById('historyList');
  
  if (operationHistory.length === 0) {
    listEl.innerHTML = '<p style="text-align:center;color:#9ca3af;padding:40px;">Aucune opération effectuée</p>';
  } else {
    let html = '';
    operationHistory.forEach(op => {
      const colors = {
        'Dépôt': '#10b981',
        'Retrait': '#ef4444',
        'Consultation': '#6b7280'
      };
      const color = colors[op.type] || '#6b7280';
      
      html += `
        <div class="history-item" style="border-left-color:${color}">
          <div>
            <strong style="color:${color}">${op.type}</strong><br>
            <small style="color:#9ca3af">${op.date} à ${op.time}</small>
          </div>
          <div style="font-size:1.2em;font-weight:bold;color:${color}">
            ${op.amount > 0 ? op.amount + ' €' : '—'}
          </div>
        </div>
      `;
    });
    listEl.innerHTML = html;
  }
  
  showScreen('historyScreen');
}

function backToMenu() {
  showScreen('menuScreen');
}

// Opérateur
function showOperatorLogin() {
  document.getElementById('operatorCode').value = '';
  showScreen('operatorLoginScreen');
}

function operatorLogin() {
  const code = document.getElementById('operatorCode').value.trim();
  if (code === operatorCode) {
    currentOperator = { name: 'Opérateur' };
    showScreen('operatorMenuScreen');
  } else {
    showError('operatorLoginError', 'Code incorrect');
  }
}

function operatorLogout() {
  currentOperator = null;
  showScreen('loginScreen');
}

function showBlockedCards() {
  const list = document.getElementById('blockedCardsList');
  const blocked = Object.keys(blockedCards);
  
  if (blocked.length === 0) {
    list.innerHTML = '<p style="text-align:center;color:#10b981;padding:20px">Aucune carte bloquée</p>';
  } else {
    list.innerHTML = '<p style="margin-bottom:10px;font-weight:600">Cartes bloquées:</p><ul style="list-style:none;padding:0">' +
      blocked.map(c => `<li style="background:#fee2e2;padding:10px;margin:5px 0;border-radius:5px;font-family:monospace">${c}</li>`).join('') +
      '</ul>';
  }
  showScreen('blockedCardsScreen');
}

function releaseAllCards() {
  blockedCards = {};
  loginAttempts = {};
  alert('Toutes les cartes ont été libérées');
  showBlockedCards();
}

function showCollectDeposits() {
  document.getElementById('totalDeposits').textContent = totalDepositsToday + ' €';
  showScreen('collectScreen');
}

function collectDeposits() {
  alert(`${totalDepositsToday}€ collectés avec succès`);
  totalDepositsToday = 0;
  document.getElementById('totalDeposits').textContent = '0 €';
}

function showRefillATM() {
  document.getElementById('refillAmount').value = '';
  document.getElementById('refillMessage').textContent = '';
  showScreen('refillScreen');
}

function refillATM() {
  const amount = parseInt(document.getElementById('refillAmount').value);
  if (amount && amount > 0) {
    showSuccess('refillMessage', `Machine rechargée avec ${amount}€`);
  } else {
    showError('refillMessage', 'Montant invalide');
  }
}

function showStatistics() {
  const stats = `STATISTIQUES DAB\n\n` +
    `Cartes bloquées: ${Object.keys(blockedCards).length}\n` +
    `Dépôts du jour: ${totalDepositsToday}€\n` +
    `Transactions: ${dailyTransactions}\n` +
    `Tentatives connexion: ${Object.keys(loginAttempts).length}`;
  alert(stats);
}

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('cardNumber').addEventListener('input', e => {
    e.target.value = e.target.value.replace(/\D/g, '');
  });
  document.getElementById('secret').addEventListener('keypress', e => {
    if (e.key === 'Enter') login();
  });
});
</script>
</body>
</html>
