<!DOCTYPE html> 
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DAB - La Banque du Peuple</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .container { 
    max-width: 450px; 
    width: 100%;
    background: white; 
    padding: 30px; 
    border-radius: 15px; 
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  }
  h1 { 
    text-align: center; 
    color: #2563eb; 
    margin-bottom: 10px;
    font-size: 1.8em;
  }
  h2 { 
    text-align: center; 
    color: #2563eb; 
    margin-bottom: 20px;
    font-size: 1.4em;
  }
  .screen { display: none; }
  .screen.active { display: block; animation: fadeIn 0.3s; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  
  .form-group { margin-bottom: 15px; }
  label { 
    display: block; 
    margin-bottom: 8px; 
    font-weight: 600;
    color: #374151;
  }
  input { 
    width: 100%; 
    padding: 12px; 
    font-size: 16px; 
    border: 2px solid #e5e7eb; 
    border-radius: 8px;
    transition: border-color 0.3s;
  }
  input:focus { 
    border-color: #2563eb; 
    outline: none; 
  }
  
  button { 
    width: 100%; 
    padding: 14px; 
    font-size: 16px; 
    font-weight: 600;
    background: #2563eb; 
    color: white; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    margin: 8px 0;
    transition: all 0.3s;
  }
  button:hover { 
    background: #1d4ed8; 
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(37,99,235,0.3);
  }
  button.secondary { 
    background: #6b7280; 
  }
  button.secondary:hover { 
    background: #4b5563; 
  }
  
  .balance { 
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    color: white; 
    padding: 25px; 
    border-radius: 12px; 
    text-align: center; 
    margin: 20px 0;
    box-shadow: 0 4px 15px rgba(37,99,235,0.3);
  }
  .balance h2 { color: white; margin: 0; font-size: 2em; }
  .balance p { margin-top: 5px; opacity: 0.9; }
  
  .error { 
    background: #fee2e2; 
    color: #991b1b; 
    padding: 12px; 
    border-radius: 8px; 
    margin: 10px 0; 
    border-left: 4px solid #dc2626; 
    display: none; 
  }
  .error.show { display: block; }
  
  .success { 
    background: #d1fae5; 
    color: #065f46; 
    padding: 12px; 
    border-radius: 8px; 
    margin: 10px 0; 
    border-left: 4px solid #10b981; 
    display: none; 
  }
  .success.show { display: block; }
  
  .menu-item { 
    background: #f9fafb; 
    border: 2px solid #e5e7eb; 
    text-align: left; 
    display: flex; 
    align-items: center; 
    padding: 16px;
    font-weight: 600;
  }
  .menu-item:hover { 
    border-color: #2563eb;
    background: #eff6ff;
  }
  .menu-icon { 
    margin-right: 12px; 
    font-size: 1.5em; 
  }
  
  .history-item {
    background: #f9fafb;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    border-left: 4px solid #2563eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .history-list {
    max-height: 400px;
    overflow-y: auto;
    margin: 15px 0;
  }
  .history-list::-webkit-scrollbar { width: 6px; }
  .history-list::-webkit-scrollbar-track { background: #f1f1f1; }
  .history-list::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
</style>
</head>
<body>
  <div class="container">
    <h1>🏧 La Banque du Peuple</h1>

    <!-- ÉCRAN 1 : Authentification -->
    <div id="loginScreen" class="screen active">
      <h2>Authentification</h2>
      <div class="form-group">
        <label for="cardNumber">Numéro de carte (16 chiffres)</label>
        <input type="text" id="cardNumber" maxlength="16" placeholder="1234567890123456">
      </div>
      <div class="form-group">
        <label for="pin">Code PIN (4 chiffres)</label>
        <input type="password" id="pin" maxlength="4" placeholder="****">
      </div>
      <div id="loginError" class="error"></div>
      <button onclick="app.login()">Se connecter</button>
      <button class="secondary" onclick="app.showOperatorLogin()">🔧 Mode Opérateur</button>
    </div>

    <!-- ÉCRAN 2 : Menu Client -->
    <div id="menuScreen" class="screen">
      <h2>Bonjour <span id="userName">Client</span> !</h2>
      <button class="menu-item" onclick="app.showBalance()">
        <span class="menu-icon">👁️</span> Voir mon solde
      </button>
      <button class="menu-item" onclick="app.showWithdraw()">
        <span class="menu-icon">💰</span> Retirer de l'argent
      </button>
      <button class="menu-item" onclick="app.showDeposit()">
        <span class="menu-icon">➕</span> Déposer de l'argent
      </button>
      <button class="menu-item" onclick="app.showHistory()">
        <span class="menu-icon">📋</span> Historique des opérations
      </button>
      <button class="secondary" onclick="app.logout()">Déconnexion</button>
    </div>

    <!-- ÉCRAN 3 : Solde -->
    <div id="balanceScreen" class="screen">
      <h2>Votre solde</h2>
      <div class="balance">
        <h2 id="balanceAmount">0 €</h2>
        <p>Solde disponible</p>
      </div>
      <button class="secondary" onclick="app.backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 4 : Retrait -->
    <div id="withdrawScreen" class="screen">
      <h2>Retirer de l'argent</h2>
      <div class="form-group">
        <label for="withdrawAmount">Montant à retirer</label>
        <input type="number" id="withdrawAmount" min="10" max="500" step="10" placeholder="Ex: 50">
      </div>
      <div id="withdrawError" class="error"></div>
      <div id="withdrawSuccess" class="success"></div>
      <button onclick="app.withdraw()">Confirmer le retrait</button>
      <button class="secondary" onclick="app.backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 5 : Dépôt -->
    <div id="depositScreen" class="screen">
      <h2>Déposer de l'argent</h2>
      <div class="form-group">
        <label for="depositAmount">Montant à déposer</label>
        <input type="number" id="depositAmount" min="10" step="10" placeholder="Ex: 100">
      </div>
      <div id="depositError" class="error"></div>
      <div id="depositSuccess" class="success"></div>
      <button onclick="app.deposit()">Confirmer le dépôt</button>
      <button class="secondary" onclick="app.backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 6 : Historique -->
    <div id="historyScreen" class="screen">
      <h2>📋 Historique</h2>
      <div id="historyList" class="history-list"></div>
      <button class="secondary" onclick="app.backToMenu()">← Retour au menu</button>
    </div>

    <!-- ÉCRAN 7 : Connexion Opérateur -->
    <div id="operatorLoginScreen" class="screen">
      <h2>🔧 Mode Opérateur</h2>
      <div class="form-group">
        <label for="operatorCode">Code Opérateur</label>
        <input type="password" id="operatorCode" maxlength="6" placeholder="******">
      </div>
      <div id="operatorLoginError" class="error"></div>
      <button onclick="app.operatorLogin()">Se connecter</button>
      <button class="secondary" onclick="app.showScreen('loginScreen')">← Retour</button>
    </div>

    <!-- ÉCRAN 8 : Menu Opérateur -->
    <div id="operatorMenuScreen" class="screen">
      <h2>🔧 Menu Opérateur</h2>
      <p style="text-align:center; margin-bottom:20px; color:#6b7280;">Bienvenue Opérateur</p>
      <button class="menu-item" onclick="app.showBlockedCards()">
        <span class="menu-icon">🔒</span> Cartes avalées
      </button>
      <button class="menu-item" onclick="app.showCollectDeposits()">
        <span class="menu-icon">💰</span> Collecter dépôts
      </button>
      <button class="menu-item" onclick="app.showRefillATM()">
        <span class="menu-icon">🏧</span> Recharger DAB
      </button>
      <button class="menu-item" onclick="app.showStatistics()">
        <span class="menu-icon">📊</span> Statistiques
      </button>
      <button class="secondary" onclick="app.operatorLogout()">Déconnexion</button>
    </div>

    <!-- ÉCRAN 9 : Cartes avalées -->
    <div id="blockedCardsScreen" class="screen">
      <h2>🔒 Cartes avalées</h2>
      <div id="blockedCardsList" style="margin:20px 0;"></div>
      <button onclick="app.releaseAllCards()">🔓 Libérer toutes les cartes</button>
      <button class="secondary" onclick="app.showScreen('operatorMenuScreen')">← Retour</button>
    </div>

    <!-- ÉCRAN 10 : Collecter dépôts -->
    <div id="collectScreen" class="screen">
      <h2>💰 Collecter dépôts</h2>
      <div class="balance">
        <h2><span id="totalDeposits">0 €</span></h2>
        <p>Total à collecter</p>
      </div>
      <button onclick="app.collectDeposits()">✅ Marquer comme collecté</button>
      <button class="secondary" onclick="app.showScreen('operatorMenuScreen')">← Retour</button>
    </div>

    <!-- ÉCRAN 11 : Recharger DAB -->
    <div id="refillScreen" class="screen">
      <h2>🏧 Recharger DAB</h2>
      <div class="form-group">
        <label for="refillAmount">Montant à ajouter (€)</label>
        <input type="number" id="refillAmount" placeholder="Ex: 5000" step="100">
      </div>
      <div id="refillMessage" class="success"></div>
      <button onclick="app.refillATM()">💰 Recharger la machine</button>
      <button class="secondary" onclick="app.showScreen('operatorMenuScreen')">← Retour</button>
    </div>

  </div>

<script>
// Application DAB - Architecture améliorée
const app = {
  // Données
  validCards: {
    '1234567890123456': { pin: '6453', name: 'M. Dupont', balance: 2500, type: 'Banque' },
    '9876543210987654': { pin: '5628', name: 'Mme Martin', balance: 1750, type: 'Visa' }
  },
  
  // État de l'application
  currentUser: null,
  currentOperator: null,
  operationHistory: [],
  loginAttempts: {},
  blockedCards: {},
  totalDepositsToday: 0,
  dailyTransactions: 0,
  operatorCode: '539757',

  // Navigation
  showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    const screen = document.getElementById(screenId);
    if (screen) {
      screen.classList.add('active');
      this.hideMessages();
    } else {
      console.error('Écran introuvable:', screenId);
    }
  },

  hideMessages() {
    document.querySelectorAll('.error, .success').forEach(el => {
      el.classList.remove('show');
      el.textContent = '';
    });
  },

  showError(id, message) {
    const el = document.getElementById(id);
    if (el) {
      el.textContent = message;
      el.classList.add('show');
    }
  },

  showSuccess(id, message) {
    const el = document.getElementById(id);
    if (el) {
      el.textContent = message;
      el.classList.add('show');
    }
  },

  // Authentification Client
  login() {
    const cardNumber = document.getElementById('cardNumber').value.trim();
    const pin = document.getElementById('pin').value.trim();

    if (this.blockedCards[cardNumber]) {
      this.showError('loginError', 'Carte avalée. Contactez le service client.');
      return;
    }

    if (this.validCards[cardNumber] && this.validCards[cardNumber].pin === pin) {
      this.loginAttempts[cardNumber] = 0;
      this.currentUser = this.validCards[cardNumber];
      this.operationHistory = [];
      document.getElementById('userName').textContent = this.currentUser.name;
      this.updateBalanceDisplay();
      this.showScreen('menuScreen');
    } else {
      this.loginAttempts[cardNumber] = (this.loginAttempts[cardNumber] || 0) + 1;
      if (this.loginAttempts[cardNumber] >= 3) {
        this.blockedCards[cardNumber] = true;
        this.showError('loginError', '❌ Carte avalée après 3 tentatives.');
      } else {
        this.showError('loginError', `❌ Identifiants incorrects (${this.loginAttempts[cardNumber]}/3)`);
      }
    }
  },

  logout() {
    this.currentUser = null;
    this.operationHistory = [];
    document.getElementById('cardNumber').value = '';
    document.getElementById('pin').value = '';
    this.showScreen('loginScreen');
  },

  // Opérations bancaires
  updateBalanceDisplay() {
    document.getElementById('balanceAmount').textContent = this.currentUser.balance + ' €';
  },

  showBalance() {
    this.addToHistory('Consultation', 0);
    this.updateBalanceDisplay();
    this.showScreen('balanceScreen');
  },

  showWithdraw() {
    document.getElementById('withdrawAmount').value = '';
    this.showScreen('withdrawScreen');
  },

  withdraw() {
    this.hideMessages();
    const amount = parseInt(document.getElementById('withdrawAmount').value, 10);
    
    if (!amount || amount <= 0) {
      this.showError('withdrawError', 'Montant invalide');
      return;
    }
    if (amount < 10) {
      this.showError('withdrawError', 'Minimum: 10€');
      return;
    }
    if (amount > 500) {
      this.showError('withdrawError', 'Maximum: 500€');
      return;
    }
    if (amount % 10 !== 0) {
      this.showError('withdrawError', 'Multiples de 10€ uniquement');
      return;
    }
    if (amount > this.currentUser.balance) {
      this.showError('withdrawError', 'Solde insuffisant');
      return;
    }

    this.currentUser.balance -= amount;
    this.dailyTransactions++;
    this.addToHistory('Retrait', amount);
    this.updateBalanceDisplay();
    this.showSuccess('withdrawSuccess', `✅ Retrait de ${amount}€ effectué`);
    document.getElementById('withdrawAmount').value = '';
  },

  showDeposit() {
    document.getElementById('depositAmount').value = '';
    this.showScreen('depositScreen');
  },

  deposit() {
    this.hideMessages();
    const amount = parseInt(document.getElementById('depositAmount').value, 10);
    
    if (!amount || amount <= 0) {
      this.showError('depositError', 'Montant invalide');
      return;
    }
    if (amount < 10) {
      this.showError('depositError', 'Minimum: 10€');
      return;
    }
    if (amount % 10 !== 0) {
      this.showError('depositError', 'Multiples de 10€ uniquement');
      return;
    }

    this.currentUser.balance += amount;
    this.totalDepositsToday += amount;
    this.dailyTransactions++;
    this.addToHistory('Dépôt', amount);
    this.updateBalanceDisplay();
    this.showSuccess('depositSuccess', `✅ Dépôt de ${amount}€ effectué`);
    document.getElementById('depositAmount').value = '';
  },

  // Historique
  addToHistory(type, amount) {
    const now = new Date();
    this.operationHistory.unshift({
      type: type,
      amount: amount,
      date: now.toLocaleDateString('fr-FR'),
      time: now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
    });
  },

  showHistory() {
    const listEl = document.getElementById('historyList');
    
    if (this.operationHistory.length === 0) {
      listEl.innerHTML = '<p style="text-align:center;color:#9ca3af;padding:40px;">Aucune opération effectuée</p>';
    } else {
      let html = '';
      this.operationHistory.forEach(op => {
        const colors = {
          'Dépôt': '#10b981',
          'Retrait': '#ef4444',
          'Consultation': '#6b7280'
        };
        const color = colors[op.type] || '#6b7280';
        
        html += `
          <div class="history-item" style="border-left-color:${color}">
            <div>
              <strong style="color:${color}">${op.type}</strong><br>
              <small style="color:#9ca3af">${op.date} à ${op.time}</small>
            </div>
            <div style="font-size:1.2em;font-weight:bold;color:${color}">
              ${op.amount > 0 ? op.amount + ' €' : '—'}
            </div>
          </div>
        `;
      });
      listEl.innerHTML = html;
    }
    
    this.showScreen('historyScreen');
  },

  backToMenu() {
    this.showScreen('menuScreen');
  },

  // Opérateur
  showOperatorLogin() {
    document.getElementById('operatorCode').value = '';
    this.showScreen('operatorLoginScreen');
  },

  operatorLogin() {
    const code = document.getElementById('operatorCode').value.trim();
    if (code === this.operatorCode) {
      this.currentOperator = { name: 'Opérateur' };
      this.showScreen('operatorMenuScreen');
    } else {
      this.showError('operatorLoginError', 'Code incorrect');
    }
  },

  operatorLogout() {
    this.currentOperator = null;
    this.showScreen('loginScreen');
  },

  showBlockedCards() {
    const list = document.getElementById('blockedCardsList');
    const blocked = Object.keys(this.blockedCards);
    
    if (blocked.length === 0) {
      list.innerHTML = '<p style="text-align:center;color:#10b981;padding:20px">✅ Aucune carte bloquée</p>';
    } else {
      list.innerHTML = '<p style="margin-bottom:10px;font-weight:600">⚠️ Cartes bloquées:</p><ul style="list-style:none;padding:0">' +
        blocked.map(c => `<li style="background:#fee2e2;padding:10px;margin:5px 0;border-radius:5px;font-family:monospace">${c}</li>`).join('') +
        '</ul>';
    }
    this.showScreen('blockedCardsScreen');
  },

  releaseAllCards() {
    this.blockedCards = {};
    this.loginAttempts = {};
    alert('✅ Toutes les cartes ont été libérées');
    this.showBlockedCards();
  },

  showCollectDeposits() {
    document.getElementById('totalDeposits').textContent = this.totalDepositsToday + ' €';
    this.showScreen('collectScreen');
  },

  collectDeposits() {
    alert(`💰 ${this.totalDepositsToday}€ collectés avec succès`);
    this.totalDepositsToday = 0;
    document.getElementById('totalDeposits').textContent = '0 €';
  },

  showRefillATM() {
    document.getElementById('refillAmount').value = '';
    document.getElementById('refillMessage').textContent = '';
    this.showScreen('refillScreen');
  },

  refillATM() {
    const amount = parseInt(document.getElementById('refillAmount').value);
    if (amount && amount > 0) {
      this.showSuccess('refillMessage', `✅ Machine rechargée avec ${amount}€`);
    } else {
      this.showError('refillMessage', '❌ Montant invalide');
    }
  },

  showStatistics() {
    const stats = `📊 STATISTIQUES DAB\n\n` +
      `• Cartes bloquées: ${Object.keys(this.blockedCards).length}\n` +
      `• Dépôts du jour: ${this.totalDepositsToday}€\n` +
      `• Transactions: ${this.dailyTransactions}\n` +
      `• Tentatives connexion: ${Object.keys(this.loginAttempts).length}`;
    alert(stats);
  }
};

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  // Limitation saisies numériques
  document.getElementById('cardNumber').addEventListener('input', e => {
    e.target.value = e.target.value.replace(/\D/g, '');
  });
  document.getElementById('pin').addEventListener('input', e => {
    e.target.value = e.target.value.replace(/\D/g, '');
  });
  
  // Touche Entrée sur login
  document.getElementById('pin').addEventListener('keypress', e => {
    if (e.key === 'Enter') app.login();
  });
  
  console.log('✅ DAB initialisé - Comptes test:');
  console.log('Client: 1234567890123456 / PIN: 6453');
  console.log('Opérateur: 539757');
});
</script>
</body>
</html>
