<!DOCTYPE html> 
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DAB Simple avec d√©p√¥t</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; }
  .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);}
  h1, h2 { text-align: center; color: #2563eb; }
  .screen { display: none; }
  .screen.active { display: block; }
  .form-group { margin-bottom: 15px; }
  label { display: block; margin-bottom: 5px; font-weight: bold; }
  input { width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box; }
  input:focus { border-color: #2563eb; outline: none; }
  button { width: 100%; padding: 12px; font-size: 16px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px 0; }
  button.secondary { background: #6b7280; }
  button:hover { background: #1d4ed8; }
  button.secondary:hover { background: #4b5563; }
  .balance { background: #2563eb; color: white; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0; }
  .error { background: #fee; color: #c00; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #c00; display: none; }
  .error.show { display: block; }
  .success { background: #efe; color: #060; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #060; display: none; }
  .success.show { display: block; }
  .menu-item { background: #f8f9fa; border: 2px solid #ddd; margin: 10px 0; text-align: left; display: flex; align-items: center; padding: 15px; cursor: pointer; }
  .menu-item:hover { border-color: #2563eb; }
  .menu-icon { margin-right: 15px; font-size: 1.2em; }
</style>
</head>
<body>
  <div class="container">
    <h1>üèß La banque du peuple</h1>

    <!-- √âCRAN 1 : Authentification -->
    <div id="loginScreen" class="screen active">
      <h2>Authentification</h2>
      <div class="form-group">
        <label for="cardNumber">Num√©ro de carte (16 chiffres):</label>
        <input type="text" id="cardNumber" maxlength="16" placeholder="1234567890123456" />
      </div>
      <div class="form-group">
        <label for="pin">Code PIN (4 chiffres):</label>
        <input type="password" id="pin" maxlength="4" placeholder="1234" />
      </div>
      <div id="loginError" class="error"></div>
      <button onclick="login()">Se connecter</button>
      <button class="secondary" onclick="showOperatorLogin()" style="margin-top: 10px; font-size: 12px;">üîß Mode Op√©rateur</button>
    </div>

    <!-- √âCRAN 2 : Menu principal -->
    <div id="menuScreen" class="screen">
      <h2>Bonjour <span id="userName">Client</span> !</h2>
      <button class="menu-item" onclick="showBalance()"><span class="menu-icon">üëÅÔ∏è</span>Voir mon solde</button>
      <button class="menu-item" onclick="showWithdraw()"><span class="menu-icon">üí∞</span>Retirer de l'argent</button>
      <button class="menu-item" onclick="showDeposit()"><span class="menu-icon">‚ûï</span>D√©poser de l'argent</button>
      <button class="menu-item" onclick="showHistory()"><span class="menu-icon">üìã</span>Historique des op√©rations</button>
      <button class="secondary" onclick="logout()">D√©connexion</button>
    </div>

    <!-- √âCRAN 3 : Affichage du solde -->
    <div id="balanceScreen" class="screen">
      <h2>Votre solde</h2>
      <div class="balance"><h2 id="balanceAmount">0 ‚Ç¨</h2><p>Solde disponible</p></div>
      <button class="secondary" onclick="backToMenu()">Retour au menu</button>
    </div>

    <!-- √âCRAN 4 : Retrait -->
    <div id="withdrawScreen" class="screen">
      <h2>Retirer de l'argent</h2>
      <div class="form-group">
        <label for="withdrawAmount">Montant √† retirer :</label>
        <input type="number" id="withdrawAmount" min="10" max="500" step="10" placeholder="Ex : 50" />
      </div>
      <div id="withdrawError" class="error"></div>
      <div id="withdrawSuccess" class="success"></div>
      <button onclick="withdraw()">Retirer</button>
      <button class="secondary" onclick="backToMenu()">Retour au menu</button>
    </div>

    <!-- √âCRAN 5 : D√©p√¥t -->
    <div id="depositScreen" class="screen">
      <h2>D√©poser de l'argent</h2>
      <div class="form-group">
        <label for="depositAmount">Montant √† d√©poser :</label>
        <input type="number" id="depositAmount" min="10" step="10" placeholder="Ex : 100" />
      </div>
      <div id="depositError" class="error"></div>
      <div id="depositSuccess" class="success"></div>
      <button onclick="deposit()">D√©poser</button>
      <button class="secondary" onclick="backToMenu()">Retour au menu</button>
    </div>

    <!-- √âCRAN 6 : Historique des op√©rations -->
    <div id="historyScreen" class="screen">
      <h2>üìã Historique des op√©rations</h2>
      <div id="historyList" style="max-height:400px; overflow-y:auto;"></div>
      <button class="secondary" onclick="backToMenu()">Retour au menu</button>
    </div>

    <!-- √âCRAN 7 : Connexion Op√©rateur -->
    <div id="operatorLoginScreen" class="screen">
      <h2>üîß Connexion Op√©rateur</h2>
      <div class="form-group">
        <label for="operatorCode">Code Op√©rateur :</label>
        <input type="password" id="operatorCode" maxlength="6" placeholder="123456" />
      </div>
      <div id="operatorLoginError" class="error"></div>
      <button onclick="operatorLogin()">Se connecter</button>
      <button class="secondary" onclick="showScreen('loginScreen')">‚¨Ö Retour</button>
    </div>

    <!-- √âCRAN 8 : Menu Op√©rateur -->
    <div id="operatorMenuScreen" class="screen">
      <h2>üîß Menu Op√©rateur</h2>
      <p>Bonjour <span id="operatorName">Op√©rateur</span></p>
      <button class="menu-item" onclick="showBlockedCards()"><span class="menu-icon">üîí</span>Cartes aval√©es</button>
      <button class="menu-item" onclick="showCollectDeposits()"><span class="menu-icon">üí∞</span>Collecter d√©p√¥ts</button>
      <button class="menu-item" onclick="showRefillATM()"><span class="menu-icon">üèß</span>Recharger DAB</button>
      <button class="menu-item" onclick="showStatistics()"><span class="menu-icon">üìä</span>Statistiques</button>
      <button class="secondary" onclick="operatorLogout()">üö™ D√©connexion</button>
    </div>

    <!-- √âCRAN 9 : Cartes aval√©es -->
    <div id="blockedCardsScreen" class="screen">
      <h2>üîí Cartes aval√©es</h2>
      <div id="blockedCardsList"></div>
      <button onclick="releaseAllCards()">üîì Lib√©rer toutes les cartes</button>
      <button class="secondary" onclick="showScreen('operatorMenuScreen')">‚¨Ö Retour</button>
    </div>

    <!-- √âCRAN 10 : Collecter d√©p√¥ts -->
    <div id="collectScreen" class="screen">
      <h2>üí∞ Collecter d√©p√¥ts</h2>
      <div class="balance">
        <h3>Total des d√©p√¥ts : <span id="totalDeposits">0 ‚Ç¨</span></h3>
        <p>Argent √† collecter dans la machine</p>
      </div>
      <button onclick="collectDeposits()">‚úÖ Marquer comme collect√©</button>
      <button class="secondary" onclick="showScreen('operatorMenuScreen')">‚¨Ö Retour</button>
    </div>

    <!-- √âCRAN 11 : Recharger DAB -->
    <div id="refillScreen" class="screen">
      <h2>üèß Recharger DAB</h2>
      <div class="form-group">
        <label for="refillAmount">Montant √† ajouter (en ‚Ç¨) :</label>
        <input type="number" id="refillAmount" placeholder="Ex: 5000" step="100">
      </div>
      <button onclick="refillATM()">üí∞ Recharger</button>
      <button class="secondary" onclick="showScreen('operatorMenuScreen')">‚¨Ö Retour</button>
      <p id="refillMessage" class="success"></p>
    </div>

  </div>

<script>
  // === Donn√©es utilisateurs simul√©es ===
  const validCards = {
    '1234567890123456': { pin: '6453', name: 'M. Dupont', balance: 2500, type: 'Banque' },
    '9876543210987654': { pin: '5628', name: 'Mme Martin', balance: 1750, type: 'Visa' }
  };
  
  // Suivi des tentatives et cartes bloqu√©es
  let loginAttempts = {};
  let blockedCards = {};
  
  // Variables d'√©tat
  let currentUser = null;
  let operationHistory = [];
  let currentOperator = null;
  const operatorCode = '539757';
  
  // Variables pour les statistiques op√©rateur
  let totalDepositsToday = 0;
  let dailyTransactions = 0;

  // === Navigation entre √©crans ===
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    hideMessages();
  }

  function hideMessages() {
    document.querySelectorAll('.error, .success').forEach(el => {
      el.classList.remove('show');
      el.textContent = '';
    });
  }

  // === Fonction pour enregistrer une op√©ration dans l'historique ===
  function addToHistory(type, amount) {
    const now = new Date();
    const operation = {
      type: type,
      amount: amount,
      date: now.toLocaleDateString('fr-FR'),
      time: now.toLocaleTimeString('fr-FR', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      })
    };
    operationHistory.unshift(operation);
  }

  // === Afficher l'√©cran historique ===
  function showHistory() {
    const historyList = document.getElementById('historyList');
    
    if (operationHistory.length === 0) {
      historyList.innerHTML = '<p style="text-align:center; color:#999;">Aucune op√©ration effectu√©e</p>';
    } else {
      let html = '<ul style="list-style:none; padding:0;">';
      
      operationHistory.forEach(op => {
        let icon = '';
        let color = '';
        if (op.type === 'D√©p√¥t') {
          icon = '‚ûï';
          color = '#060';
        } else if (op.type === 'Retrait') {
          icon = 'üí∞';
          color = '#c00';
        } else {
          icon = 'üëÅÔ∏è';
          color = '#666';
        }
        
        html += `
          <li style="background:#f8f9fa; padding:15px; margin:10px 0; border-left:4px solid ${color}; border-radius:5px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                <strong style="color:${color};">${icon} ${op.type}</strong>
                <br>
                <small style="color:#666;">${op.date} √† ${op.time}</small>
              </div>
              <div style="font-size:1.2em; font-weight:bold; color:${color};">
                ${op.amount > 0 ? op.amount + ' ‚Ç¨' : '‚Äî'}
              </div>
            </div>
          </li>
        `;
      });
      
      html += '</ul>';
      historyList.innerHTML = html;
    }
    
    showScreen('historyScreen');
  }

  // === Authentification ===
  function login() {
    const cardNumber = document.getElementById('cardNumber').value.trim();
    const pin = document.getElementById('pin').value.trim();

    if (blockedCards[cardNumber]) {
      showError('loginError', 'Carte aval√©e. Contactez le service de maintenance.');
      return;
    }

    if (validCards[cardNumber] && validCards[cardNumber].pin === pin) {
      loginAttempts[cardNumber] = 0;
      currentUser = validCards[cardNumber];
      document.getElementById('userName').textContent = currentUser.name;
      updateBalanceDisplay();
      showScreen('menuScreen');
    } else {
      loginAttempts[cardNumber] = (loginAttempts[cardNumber] || 0) + 1;
      if (loginAttempts[cardNumber] >= 3) {
        blockedCards[cardNumber] = true;
        showError('loginError', 'Carte aval√©e apr√®s 3 tentatives. Contactez le service de maintenance.');
      } else {
        showError('loginError', `Num√©ro de carte ou PIN incorrect (${loginAttempts[cardNumber]} / 3)`);
      }
    }
  }

  // === Mise √† jour du solde affich√© ===
  function updateBalanceDisplay() {
    document.getElementById('balanceAmount').textContent = currentUser.balance + ' ‚Ç¨';
  }

  // === Fonction de d√©connexion ===
  function logout() {
    operationHistory = [];
    currentUser = null;
    document.getElementById('cardNumber').value = '';
    document.getElementById('pin').value = '';
    document.getElementById('withdrawAmount').value = '';
    document.getElementById('depositAmount').value = '';
    showScreen('loginScreen');
  }

  // === Afficher √©cran solde ===
  function showBalance() {
    updateBalanceDisplay();
    addToHistory('Consultation', 0);
    showScreen('balanceScreen');
  }

  // === Afficher √©cran retrait ===
  function showWithdraw() {
    document.getElementById('withdrawAmount').value = '';
    hideMessages();
    showScreen('withdrawScreen');
  }

  // === Afficher √©cran d√©p√¥t ===
  function showDeposit() {
    document.getElementById('depositAmount').value = '';
    hideMessages();
    showScreen('depositScreen');
  }

  // === Retour au menu ===
  function backToMenu() {
    hideMessages();
    showScreen('menuScreen');
  }

  // === Retrait d'argent ===
  function withdraw() {
    hideMessages();
    const amount = parseInt(document.getElementById('withdrawAmount').value, 10);
    if (!amount || amount <= 0) {
      showError('withdrawError', 'Veuillez saisir un montant valide');
      return;
    }
    if (amount < 10) {
      showError('withdrawError', 'Montant minimum : 10‚Ç¨');
      return;
    }
    if (amount > 500) {
      showError('withdrawError', 'Montant maximum : 500‚Ç¨');
      return;
    }
    if (amount % 10 !== 0) {
      showError('withdrawError', 'Le montant doit √™tre un multiple de 10‚Ç¨');
      return;
    }
    if (amount > currentUser.balance) {
      showError('withdrawError', 'Solde insuffisant');
      return;
    }

    currentUser.balance -= amount;
    addToHistory('Retrait', amount);
    dailyTransactions += 1;
    updateBalanceDisplay();
    showSuccess('withdrawSuccess', `Retrait de ${amount}‚Ç¨ effectu√© avec succ√®s`);
    document.getElementById('withdrawAmount').value = '';
  }

  // === D√©p√¥t d'argent ===
  function deposit() {
    hideMessages();
    const amount = parseInt(document.getElementById('depositAmount').value, 10);
    if (!amount || amount <= 0) {
      showError('depositError', 'Veuillez saisir un montant valide');
      return;
    }
    if (amount < 10) {
      showError('depositError', 'Montant minimum : 10‚Ç¨');
      return;
    }
    if (amount % 10 !== 0) {
      showError('depositError', 'Le montant doit √™tre un multiple de 10‚Ç¨');
      return;
    }

    currentUser.balance += amount;
    addToHistory('D√©p√¥t', amount);
    totalDepositsToday += amount;
    dailyTransactions += 1;
    updateBalanceDisplay();
    showSuccess('depositSuccess', `D√©p√¥t de ${amount}‚Ç¨ effectu√© avec succ√®s`);
    document.getElementById('depositAmount').value = '';
  }

  // === Affichage des erreurs et succ√®s ===
  function showError(id, message) {
    const el = document.getElementById(id);
    el.textContent = message;
    el.classList.add('show');
  }

  function showSuccess(id, message) {
    const el = document.getElementById(id);
    el.textContent = message;
    el.classList.add('show');
  }

  // === Fonctions Op√©rateur ===
  function showOperatorLogin() {
    document.getElementById('operatorCode').value = '';
    hideMessages();
    showScreen('operatorLoginScreen');
  }

  function operatorLogin() {
    const code = document.getElementById('operatorCode').value.trim();
    
    if (code === operatorCode) {
      currentOperator = { name: 'Op√©rateur', code: code };
      showScreen('operatorMenuScreen');
    } else {
      showError('operatorLoginError', 'Code op√©rateur incorrect');
    }
  }

  function showBlockedCards() {
    updateBlockedCardsList();
    showScreen('blockedCardsScreen');
  }

  function showCollectDeposits() {
    document.getElementById('totalDeposits').textContent = totalDepositsToday + ' ‚Ç¨';
    showScreen('collectScreen');
  }

  function showRefillATM() {
    document.getElementById('refillAmount').value = '';
    document.getElementById('refillMessage').textContent = '';
    showScreen('refillScreen');
  }

  function showStatistics() {
    alert('üìä Statistiques DAB :\n' +
      '- Cartes aval√©es : ' + Object.keys(blockedCards).length + '\n' +
      '- D√©p√¥ts du jour : ' + totalDepositsToday + '‚Ç¨\n' +
      '- Transactions : ' + dailyTransactions + '\n' +
      '- Tentatives de connexion : ' + Object.keys(loginAttempts).length);
  }

  function operatorLogout() {
    currentOperator = null;
    showScreen('loginScreen');
  }

  function updateBlockedCardsList() {
    const list = document.getElementById('blockedCardsList');
    const blocked = Object.keys(blockedCards);
    
    if (blocked.length === 0) {
      list.innerHTML = '<p>‚úÖ Aucune carte aval√©e</p>';
    } else {
      list.innerHTML = '<p>‚ö†Ô∏è Cartes aval√©es :</p><ul>' + 
        blocked.map(card => '<li>' + card + '</li>').join('') + '</ul>';
    }
  }

  function releaseAllCards() {
    blockedCards = {};
    loginAttempts = {};
    updateBlockedCardsList();
    alert('‚úÖ Toutes les cartes ont √©t√© lib√©r√©es !');
  }

  function collectDeposits() {
    totalDepositsToday = 0;
    document.getElementById('totalDeposits').textContent = '0 ‚Ç¨';
    alert('üí∞ D√©p√¥ts collect√©s avec succ√®s !');
  }

  function refillATM() {
    const amount = parseInt(document.getElementById('refillAmount').value);
    if (amount && amount > 0) {
      document.getElementById('refillMessage').textContent = `‚úÖ DAB recharg√© avec ${amount}‚Ç¨`;
      document.getElementById('refillMessage').classList.add('show');
    } else {
      showError('refillMessage', '‚ùå Montant invalide');
    }
  }

  // === Limitation des saisies pour carte et PIN ===
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('cardNumber').addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g, '');
    });
    document.getElementById('pin').addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g, '');
    });
  });
</script>
</body>
</html>
