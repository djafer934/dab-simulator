<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DAB Am√©lior√©</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; }
  .container { max-width: 420px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);}
  h1, h2 { text-align: center; color: #2563eb; }
  .screen { display: none; }
  .screen.active { display: block; }
  .form-group { margin-bottom: 15px; }
  label { display: block; margin-bottom: 5px; font-weight: bold; }
  input { width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px; }
  input:focus { border-color: #2563eb; outline: none; }
  button { width: 100%; padding: 12px; font-size: 16px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px 0; }
  button.secondary { background: #6b7280; }
  button:hover { background: #1d4ed8; }
  button.secondary:hover { background: #4b5563; }
  .balance { background: #2563eb; color: white; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; }
  .error { background: #fee; color: #c00; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #c00; display: none; }
  .error.show { display: block; }
  .success { background: #efe; color: #060; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #060; display: none; }
  .success.show { display: block; }
  .menu-item { background: #f8f9fa; border: 2px solid #ddd; margin: 10px 0; padding: 15px; cursor: pointer; text-align: left; }
  .menu-item:hover { border-color: #2563eb; }
  ul { padding-left: 20px; }
</style>
</head>
<body>
<div class="container">
  <h1>üèß Mon DAB Am√©lior√©</h1>

  <!-- Connexion -->
  <div id="loginScreen" class="screen active">
    <h2>Authentification</h2>
    <div class="form-group">
      <label for="cardNumber">Num√©ro de carte :</label>
      <input type="text" id="cardNumber" maxlength="16" placeholder="1234567890123456" />
    </div>
    <div class="form-group">
      <label for="pin">Code PIN :</label>
      <input type="password" id="pin" maxlength="4" placeholder="1234" />
    </div>
    <div id="loginError" class="error"></div>
    <button onclick="login()">Se connecter</button>
  </div>

  <!-- Menu -->
  <div id="menuScreen" class="screen">
    <h2>Bonjour <span id="userName">Client</span> !</h2>
    <p>Derni√®re connexion : <span id="lastLogin">-</span></p>
    <button class="menu-item" onclick="showBalance()">üëÅÔ∏è Voir mon solde</button>
    <button class="menu-item" onclick="showWithdraw()">üí∞ Retirer</button>
    <button class="menu-item" onclick="showDeposit()">‚ûï D√©poser</button>
    <button class="menu-item" onclick="showHistory()">üìú Historique</button>
    <button class="menu-item" onclick="showChangePin()">üîë Changer mon PIN</button>
    <button class="secondary" onclick="logout()">D√©connexion</button>
  </div>

  <!-- Solde -->
  <div id="balanceScreen" class="screen">
    <h2>Votre solde</h2>
    <div class="balance"><h2 id="balanceAmount">0 ‚Ç¨</h2></div>
    <button class="secondary" onclick="backToMenu()">Retour</button>
  </div>

  <!-- Retrait -->
  <div id="withdrawScreen" class="screen">
    <h2>Retirer</h2>
    <input type="number" id="withdrawAmount" min="10" max="500" step="10" placeholder="Ex: 50" />
    <div id="withdrawError" class="error"></div>
    <div id="withdrawSuccess" class="success"></div>
    <button onclick="withdraw()">Confirmer</button>
    <button class="secondary" onclick="backToMenu()">Retour</button>
  </div>

  <!-- D√©p√¥t -->
  <div id="depositScreen" class="screen">
    <h2>D√©poser</h2>
    <input type="number" id="depositAmount" min="10" step="10" placeholder="Ex: 100" />
    <div id="depositError" class="error"></div>
    <div id="depositSuccess" class="success"></div>
    <button onclick="deposit()">Confirmer</button>
    <button class="secondary" onclick="backToMenu()">Retour</button>
  </div>

  <!-- Historique -->
  <div id="historyScreen" class="screen">
    <h2>Historique</h2>
    <ul id="historyList"></ul>
    <button class="secondary" onclick="backToMenu()">Retour</button>
  </div>

  <!-- Changement PIN -->
  <div id="changePinScreen" class="screen">
    <h2>Changer mon PIN</h2>
    <input type="password" id="oldPin" maxlength="4" placeholder="Ancien PIN" />
    <input type="password" id="newPin" maxlength="4" placeholder="Nouveau PIN" />
    <input type="password" id="confirmPin" maxlength="4" placeholder="Confirmer PIN" />
    <div id="pinError" class="error"></div>
    <div id="pinSuccess" class="success"></div>
    <button onclick="changePin()">Changer</button>
    <button class="secondary" onclick="backToMenu()">Retour</button>
  </div>
</div>

<script>
  // --- Simulation utilisateurs ---
  let users = JSON.parse(localStorage.getItem("users")) || {
    "1234567890123456": { pin: "1234", name: "M. Dupont", balance: 2500, history: [], lastLogin: null, locked: false, attempts: 0 }
  };

  let currentUser = null;
  let currentCard = null;

  // --- Navigation ---
  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".error, .success").forEach(m => { m.classList.remove("show"); m.textContent = ""; });
  }

  function backToMenu() { showScreen("menuScreen"); }

  // --- Connexion ---
  function login() {
    const card = document.getElementById("cardNumber").value.trim();
    const pin = document.getElementById("pin").value.trim();

    if (!users[card]) { showError("loginError", "Carte inconnue"); return; }
    if (users[card].locked) { showError("loginError", "Compte bloqu√© (trop de tentatives)"); return; }

    if (users[card].pin === pin) {
      currentUser = users[card];
      currentCard = card;
      currentUser.attempts = 0;
      currentUser.lastLogin = new Date().toLocaleString();
      saveUsers();
      document.getElementById("userName").textContent = currentUser.name;
      document.getElementById("lastLogin").textContent = currentUser.lastLogin;
      updateBalanceDisplay();
      showScreen("menuScreen");
    } else {
      users[card].attempts++;
      if (users[card].attempts >= 3) {
        users[card].locked = true;
        showError("loginError", "Compte bloqu√© apr√®s 3 √©checs");
      } else {
        showError("loginError", "PIN incorrect (" + users[card].attempts + "/3)");
      }
      saveUsers();
    }
  }

  // --- Solde ---
  function updateBalanceDisplay() {
    document.getElementById("balanceAmount").textContent = currentUser.balance + " ‚Ç¨";
  }
  function showBalance() { updateBalanceDisplay(); showScreen("balanceScreen"); }

  // --- D√©connexion ---
  function logout() {
    currentUser = null; currentCard = null;
    document.getElementById("cardNumber").value = "";
    document.getElementById("pin").value = "";
    showScreen("loginScreen");
  }

  // --- Retrait ---
  function withdraw() {
    const amount = parseInt(document.getElementById("withdrawAmount").value, 10);
    if (!amount || amount < 10 || amount > 500 || amount % 10 !== 0) {
      showError("withdrawError", "Montant invalide (10-500‚Ç¨, multiple de 10)"); return;
    }
    if (amount > currentUser.balance) { showError("withdrawError", "Solde insuffisant"); return; }
    currentUser.balance -= amount;
    addHistory("Retrait", amount);
    updateBalanceDisplay();
    saveUsers();
    showSuccess("withdrawSuccess", "Retrait de " + amount + "‚Ç¨ r√©ussi");
  }

  // --- D√©p√¥t ---
  function deposit() {
    const amount = parseInt(document.getElementById("depositAmount").value, 10);
    if (!amount || amount < 10 || amount % 10 !== 0) {
      showError("depositError", "Montant invalide (min 10‚Ç¨, multiple de 10)"); return;
    }
    currentUser.balance += amount;
    addHistory("D√©p√¥t", amount);
    updateBalanceDisplay();
    saveUsers();
    showSuccess("depositSuccess", "D√©p√¥t de " + amount + "‚Ç¨ r√©ussi");
  }

  // --- Historique ---
  function addHistory(type, amount) {
    currentUser.history.push({ type, amount, solde: currentUser.balance, date: new Date().toLocaleString() });
  }
  function showHistory() {
    const list = document.getElementById("historyList");
    list.innerHTML = currentUser.history.map(h => `<li>${h.date} - ${h.type} : ${h.amount}‚Ç¨ (Solde: ${h.solde}‚Ç¨)</li>`).join("");
    showScreen("historyScreen");
  }

  // --- Changement PIN ---
  function showChangePin() { showScreen("changePinScreen"); }
  function changePin() {
    const oldP = document.getElementById("oldPin").value.trim();
    const newP = document.getElementById("newPin").value.trim();
    const confirmP = document.getElementById("confirmPin").value.trim();
    if (oldP !== currentUser.pin) { showError("pinError", "Ancien PIN incorrect"); return; }
    if (newP.length !== 4 || !/^\d+$/.test(newP)) { showError("pinError", "Nouveau PIN doit avoir 4 chiffres"); return; }
    if (newP !== confirmP) { showError("pinError", "Confirmation incorrecte"); return; }
    currentUser.pin = newP;
    saveUsers();
    showSuccess("pinSuccess", "PIN modifi√© avec succ√®s");
  }

  // --- Messages ---
  function showError(id, msg) { const el = document.getElementById(id); el.textContent = msg; el.classList.add("show"); }
  function showSuccess(id, msg) { const el = document.getElementById(id); el.textContent = msg; el.classList.add("show"); }

  // --- Persistance ---
  function saveUsers() { localStorage.setItem("users", JSON.stringify(users)); }

  // --- Entr√©e uniquement chiffres pour carte/PIN ---
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("cardNumber").addEventListener("input", e => e.target.value = e.target.value.replace(/\D/g, ""));
    document.getElementById("pin").addEventListener("input", e => e.target.value = e.target.value.replace(/\D/g, ""));
  });
</script>
</body>
</html>
