<!DOCTYPE html> 
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DAB Simple avec dépôt</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; }
  .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);}
  h1, h2 { text-align: center; color: #2563eb; }
  .screen { display: none; }
  .screen.active { display: block; }
  .form-group { margin-bottom: 15px; }
  label { display: block; margin-bottom: 5px; font-weight: bold; }
  input { width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box; }
  input:focus { border-color: #2563eb; outline: none; }
  button { width: 100%; padding: 12px; font-size: 16px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px 0; }
  button.secondary { background: #6b7280; }
  button:hover { background: #1d4ed8; }
  button.secondary:hover { background: #4b5563; }
  .balance { background: #2563eb; color: white; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0; }
  .error { background: #fee; color: #c00; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #c00; display: none; }
  .error.show { display: block; }
  .success { background: #efe; color: #060; padding: 10px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #060; display: none; }
  .success.show { display: block; }
  .menu-item { background: #f8f9fa; border: 2px solid #ddd; margin: 10px 0; text-align: left; display: flex; align-items: center; padding: 15px; cursor: pointer; }
  .menu-item:hover { border-color: #2563eb; }
  .menu-icon { margin-right: 15px; font-size: 1.2em; }
</style>
</head>
<body>
  <div class="container">
    <h1>🏧 La banque pinto </h1>

    <!-- ÉCRAN 1 : Authentification -->
    <div id="loginScreen" class="screen active">
      <h2>Authentification</h2>
      <div class="form-group">
        <label for="cardNumber">Numéro de carte (16 chiffres):</label>
        <input type="text" id="cardNumber" maxlength="16" placeholder="1234567890123456" />
      </div>
      <div class="form-group">
        <label for="pin">Code PIN (4 chiffres):</label>
        <input type="password" id="pin" maxlength="4" placeholder="1234" />
      </div>
      <div id="loginError" class="error"></div>
<button onclick="login()">Se connecter</button>
<button class="secondary" onclick="showOperatorLogin()" style="margin-top: 10px; font-size: 12px;">🔧 Mode Opérateur</button>

    <!-- ÉCRAN 2 : Menu principal -->
    <div id="menuScreen" class="screen">
      <h2>Bonjour <span id="userName">Client</span> !</h2>
      <button class="menu-item" onclick="showBalance()"><span class="menu-icon">👁️</span>Voir mon solde</button>
      <button class="menu-item" onclick="showWithdraw()"><span class="menu-icon">💰</span>Retirer de l'argent</button>
      <button class="menu-item" onclick="showDeposit()"><span class="menu-icon">➕</span>Déposer de l'argent</button>
      <button class="secondary" onclick="logout()">Déconnexion</button>
    </div>

    <!-- ÉCRAN 3 : Affichage du solde -->
    <div id="balanceScreen" class="screen">
      <h2>Votre solde</h2>
      <div class="balance"><h2 id="balanceAmount">0 €</h2><p>Solde disponible</p></div>
      <button class="secondary" onclick="backToMenu()">Retour au menu</button>
    </div>

    <!-- ÉCRAN 4 : Retrait -->
    <div id="withdrawScreen" class="screen">
      <h2>Retirer de l'argent</h2>
      <div class="form-group">
        <label for="withdrawAmount">Montant à retirer :</label>
        <input type="number" id="withdrawAmount" min="10" max="500" step="10" placeholder="Ex : 50" />
      </div>
      <div id="withdrawError" class="error"></div>
      <div id="withdrawSuccess" class="success"></div>
      <button onclick="withdraw()">Retirer</button>
      <button class="secondary" onclick="backToMenu()">Retour au menu</button>
    </div>

    <!-- ÉCRAN 5 : Dépôt -->
    <div id="depositScreen" class="screen">
      <h2>Déposer de l'argent</h2>
      <div class="form-group">
        <label for="depositAmount">Montant à déposer :</label>
        <input type="number" id="depositAmount" min="10" step="10" placeholder="Ex : 100" />
      </div>
      <div id="depositError" class="error"></div>
      <div id="depositSuccess" class="success"></div>
      <button onclick="deposit()">Déposer</button>
      <button class="secondary" onclick="backToMenu()">Retour au menu</button>
    </div>
  </div>

    <!-- ÉCRAN 6 : Connexion Opérateur -->
<div id="operatorLoginScreen" class="screen">
  <h2>🔧 Connexion Opérateur</h2>
  <div class="form-group">
    <label for="operatorCode">Code Opérateur :</label>
    <input type="password" id="operatorCode" maxlength="6" placeholder="123456" />
  </div>
  <div id="operatorLoginError" class="error"></div>
  <button onclick="operatorLogin()">Se connecter</button>
  <button class="secondary" onclick="showScreen('loginScreen')">⬅ Retour</button>
</div>

    <!-- ÉCRAN 7 : Menu Opérateur -->
<div id="operatorMenuScreen" class="screen">
  <h2>🔧 Menu Opérateur</h2>
  <p>Bonjour <span id="operatorName">Opérateur</span></p>
  
  <button class="menu-item" onclick="showBlockedCards()"><span class="menu-icon">🔒</span>Cartes avalées</button>
  <button class="menu-item" onclick="showCollectDeposits()"><span class="menu-icon">💰</span>Collecter dépôts</button>
  <button class="menu-item" onclick="showRefillATM()"><span class="menu-icon">🏧</span>Recharger DAB</button>
  <button class="menu-item" onclick="showStatistics()"><span class="menu-icon">📊</span>Statistiques</button>
  <button class="secondary" onclick="operatorLogout()">🚪 Déconnexion</button>
</div>

    <!-- ÉCRAN 8 : Cartes avalées -->
<div id="blockedCardsScreen" class="screen">
  <h2>🔒 Cartes avalées</h2>
  <div id="blockedCardsList"></div>
  <button onclick="releaseAllCards()">🔓 Libérer toutes les cartes</button>
  <button class="secondary" onclick="showScreen('operatorMenuScreen')">⬅ Retour</button>
</div>

<!-- ÉCRAN 9 : Collecter dépôts -->
<div id="collectScreen" class="screen">
  <h2>💰 Collecter dépôts</h2>
  <div class="balance">
    <h3>Total des dépôts : <span id="totalDeposits">0 €</span></h3>
    <p>Argent à collecter dans la machine</p>
  </div>
  <button onclick="collectDeposits()">✅ Marquer comme collecté</button>
  <button class="secondary" onclick="showScreen('operatorMenuScreen')">⬅ Retour</button>
</div>

<!-- ÉCRAN 10 : Recharger DAB -->
<div id="refillScreen" class="screen">
  <h2>🏧 Recharger DAB</h2>
  <div class="form-group">
    <label for="refillAmount">Montant à ajouter (en €) :</label>
    <input type="number" id="refillAmount" placeholder="Ex: 5000" step="100">
  </div>
  <button onclick="refillATM()">💰 Recharger</button>
  <button class="secondary" onclick="showScreen('operatorMenuScreen')">⬅ Retour</button>
  <p id="refillMessage" class="success"></p>
</div>

</div>
</div>

    
</div>
</div>

<script>
  // === Données utilisateurs simulées ===
  const validCards = {
  '1234567890123456': { pin: '6453', name: 'M. Dupont', balance: 2500, type: 'Banque' },
  '9876543210987654': { pin: '5628', name: 'Mme Martin', balance: 1750, type: 'Visa' }
};
  // Suivi des tentatives et cartes bloquées
let loginAttempts = {};   // compte les tentatives pour chaque carte
let blockedCards = {};    // stocke les cartes avalées
  
  
  // Variables d'état
let currentUser = null;        // ← AJOUTE cette ligne ICI
let currentOperator = null;    // pour l'opérateur connecté
const operatorCode = '539757';  // code opérateur (tu peux le changer)

  // Variables pour les statistiques opérateur
let totalDepositsToday = 0;  // total des dépôts de la journée
let dailyTransactions = 0;   // nombre de transactions

  // === Navigation entre écrans ===
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    hideMessages();
  }

  function hideMessages() {
    document.querySelectorAll('.error, .success').forEach(el => {
      el.classList.remove('show');
      el.textContent = '';
    });
  }

  // === Authentification ===
  function login() {
    const cardNumber = document.getElementById('cardNumber').value.trim();
    const pin = document.getElementById('pin').value.trim();

    if (blockedCards[cardNumber]) {
        showError('loginError', 'Carte avalée. Contactez le service de maintenance.');
        return;
    }

    if (validCards[cardNumber] && validCards[cardNumber].pin === pin) {
        loginAttempts[cardNumber] = 0; // reset compteur
        currentUser = validCards[cardNumber];
        document.getElementById('userName').textContent = currentUser.name;
        updateBalanceDisplay();
        showScreen('menuScreen');
    } else {
        loginAttempts[cardNumber] = (loginAttempts[cardNumber] || 0) + 1;
        if (loginAttempts[cardNumber] >= 3) {
            blockedCards[cardNumber] = true; // carte avalée
            showError('loginError', 'Carte avalée après 3 tentatives. Contactez le service de maintenance.');
        } else {
            showError('loginError', `Numéro de carte ou PIN incorrect (${loginAttempts[cardNumber]} / 3)`);
        }
    }
}
  

  // === Mise à jour du solde affiché ===
  function updateBalanceDisplay() {
    document.getElementById('balanceAmount').textContent = currentUser.balance + ' €';
  }

  // === Fonction de déconnexion ===
  function logout() {
    currentUser = null;
    document.getElementById('cardNumber').value = '';
    document.getElementById('pin').value = '';
    document.getElementById('withdrawAmount').value = '';
    document.getElementById('depositAmount').value = '';
    showScreen('loginScreen');
  }

  // === Afficher écran solde ===
  function showBalance() {
    updateBalanceDisplay();
    showScreen('balanceScreen');
  }

  // === Afficher écran retrait ===
  function showWithdraw() {
    document.getElementById('withdrawAmount').value = '';
    hideMessages();
    showScreen('withdrawScreen');
  }

  // === Afficher écran dépôt ===
  function showDeposit() {
    document.getElementById('depositAmount').value = '';
    hideMessages();
    showScreen('depositScreen');
  }

  // === Retour au menu ===
  function backToMenu() {
    hideMessages();
    showScreen('menuScreen');
  }

  // === Retrait d'argent ===
  function withdraw() {
    hideMessages();
    const amount = parseInt(document.getElementById('withdrawAmount').value, 10);
    if (!amount || amount <= 0) {
      showError('withdrawError', 'Veuillez saisir un montant valide');
      return;
    }
    if (amount < 10) {
      showError('withdrawError', 'Montant minimum : 10€');
      return;
    }
    if (amount > 500) {
      showError('withdrawError', 'Montant maximum : 500€');
      return;
    }
    if (amount % 10 !== 0) {
      showError('withdrawError', 'Le montant doit être un multiple de 10€');
      return;
    }
    if (amount > currentUser.balance) {
      showError('withdrawError', 'Solde insuffisant');
      return;
    }

    currentUser.balance -= amount;
    dailyTransactions += 1;  // compter les retraits aussi
    updateBalanceDisplay();
    showSuccess('withdrawSuccess', `Retrait de ${amount}€ effectué avec succès`);
    document.getElementById('withdrawAmount').value = '';
  }

  // === Dépôt d'argent ===
  function deposit() {
    hideMessages();
    const amount = parseInt(document.getElementById('depositAmount').value, 10);
    if (!amount || amount <= 0) {
      showError('depositError', 'Veuillez saisir un montant valide');
      return;
    }
    if (amount < 10) {
      showError('depositError', 'Montant minimum : 10€');
      return;
    }
    if (amount % 10 !== 0) {
      showError('depositError', 'Le montant doit être un multiple de 10€');
      return;
    }

    // On ajoute le montant au solde
    currentUser.balance += amount;
    totalDepositsToday += amount;  // ajouter aux statistiques
    dailyTransactions += 1;
    updateBalanceDisplay();
    showSuccess('depositSuccess', `Dépôt de ${amount}€ effectué avec succès`);
    document.getElementById('depositAmount').value = '';
  }

  // === Affichage des erreurs et succès ===
  function showError(id, message) {
    const el = document.getElementById(id);
    el.textContent = message;
    el.classList.add('show');
  }

  function showSuccess(id, message) {
    const el = document.getElementById(id);
    el.textContent = message;
    el.classList.add('show');
  }

  // === Fonctions Opérateur ===
function showOperatorLogin() {
  document.getElementById('operatorCode').value = '';
  hideMessages();
  showScreen('operatorLoginScreen');
}

function operatorLogin() {
  const code = document.getElementById('operatorCode').value.trim();
  
  if (code === operatorCode) {
    currentOperator = { name: 'Opérateur', code: code };
    showScreen('operatorMenuScreen');
  } else {
    showError('operatorLoginError', 'Code opérateur incorrect');
  }
}

  // === Autres fonctions opérateur ===
function showBlockedCards() {
  updateBlockedCardsList();
  showScreen('blockedCardsScreen');
}

function showCollectDeposits() {
  document.getElementById('totalDeposits').textContent = totalDepositsToday + ' €';
  showScreen('collectScreen');
}

function showRefillATM() {
  document.getElementById('refillAmount').value = '';
  document.getElementById('refillMessage').textContent = '';
  showScreen('refillScreen');
}

function showStatistics() {
  alert('📊 Statistiques DAB :\n' +
    '- Cartes avalées : ' + Object.keys(blockedCards).length + '\n' +
    '- Dépôts du jour : ' + totalDepositsToday + '€\n' +
    '- Transactions : ' + dailyTransactions + '\n' +
    '- Tentatives de connexion : ' + Object.keys(loginAttempts).length);
}
function operatorLogout() {
  currentOperator = null;
  showScreen('loginScreen');
}

function updateBlockedCardsList() {
  const list = document.getElementById('blockedCardsList');
  const blocked = Object.keys(blockedCards);
  
  if (blocked.length === 0) {
    list.innerHTML = '<p>✅ Aucune carte avalée</p>';
  } else {
    list.innerHTML = '<p>⚠️ Cartes avalées :</p><ul>' + 
      blocked.map(card => '<li>' + card + '</li>').join('') + '</ul>';
  }
}

function releaseAllCards() {
  blockedCards = {};
  updateBlockedCardsList();
  alert('✅ Toutes les cartes ont été libérées !');
}

function collectDeposits() {
  alert('💰 Dépôts collectés avec succès !');
}

function refillATM() {
  const amount = parseInt(document.getElementById('refillAmount').value);
  if (amount && amount > 0) {
    document.getElementById('refillMessage').textContent = `✅ DAB rechargé avec ${amount}€`;
  } else {
    document.getElementById('refillMessage').textContent = '❌ Montant invalide';
  }
}


  // === Limitation des saisies pour carte et PIN ===
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('cardNumber').addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g, '');
    });
    document.getElementById('pin').addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g, '');
    });
  });
</script>
</body>
</html>
